$.fn.tagInput=function(f){return this.each(function(){var l=$.extend({},{labelClass:"label label-success"},f),t=$(this),a=$(this).children("input[type=hidden]"),n=$(this).children("input[type=text]");d();var e=a.val().split(",");if(""!=a.val())for(i=0;i<e.length;i++)b(e[i]);function r(){if(str=n.val(),/\S/.test(str)){str=str.replace(",",""),str=str.trim(),n.val(""),b(str);var e=n.next();e.val(e.val()+","+str),d()}}function c(e){label=0<e?t.children("span.tagLabel[data-badge="+e+"]"):t.children("span.tagLabel").last(),a.val(a.val().replace(label.text().slice(0,-2),"")),d(),label.remove()}function b(e){if(0<t.children("span.tagLabel").length){badge=n.prev();var a=badge.data("badge")+1;label=$('<span class="'+l.labelClass+' tagLabel" data-badge="'+a+'">'+e+' <a href="#" data-badge="'+a+'" aria-label="close" class="closelabel">&times;</a></span> ').insertAfter(badge)}else label=$('<span class="'+l.labelClass+' tagLabel" data-badge="1">'+e+' <a href="#" data-badge="1" aria-label="close" class="closelabel">&times;</a></span> ').insertBefore(n);label.children(".closelabel").click(function(){c($(this).data("badge"))})}function d(){s=a.val(),s=s.replace(/^( *, *)+|(, *(?=,|$))+/g,""),a.val(s)}n.keydown(function(e){var a=$(this).val();if(8==e.keyCode)0==a.length&&c(-1);else if(13==e.keyCode)return r(),e.preventDefault(),!1}),n.keyup(function(e){var a=$(this).val();if(27==e.keyCode)n.val(""),n.blur();else if(13==e.keyCode)return r(),e.preventDefault(),!1;0<=a.indexOf(",")&&r()}),n.change(function(){r()})})};